# プログラムデモアプリ：店舗エージェント商品宣伝支援システム 要件仕様書

## 1. システム概要

### 1.1 背景および動機
- **背景:**  
  クライアント店舗は、自社商品の宣伝を促進するために、個人またはパートナー企業のエージェントを活用し、SNS（Twitter、Instagram、WeChatなど）上での情報発信を支援します。
  
- **動機:**  
  エージェントは店舗の商品情報を取得し、SNSでカスタマイズした情報を発信。発信の証拠（スクリーンショット等）をサーバーにアップロードし、店舗側の審査を通過すると特典（QRコード付き画像）を受け取る仕組みにより、ブランド認知度および販売促進を図ります。

### 1.2 目的
- **クライアント店舗:** エージェントの活動を活用し、効率的かつ効果的な商品宣伝を実現する。
- **エージェント:** 商品情報の取得、カスタマイズ、SNS発信およびエビデンスアップロードによる報酬獲得。
- **開発者:** Ubuntu上で動作するWeChatミニプログラムのデモアプリとして、システムの構築および検証を行う。

### 1.3 ターゲットユーザー
- **クライアント店舗管理者:** 商品情報の管理とエージェントからのエビデンス審査・承認。
- **エージェント:** 商品情報取得、カスタマイズ、SNS投稿、エビデンスアップロード、特典受領。
- **開発者:** システムの構築、テスト、メンテナンスを行うエンジニア。

---

## 2. システム構成

### 2.1 ディレクトリ・ファイル構成

- **サーバー側 (例: `~/Projects2/server`)**
  - `server.py`: Flaskを用いたバックエンドAPI  
    → 商品情報管理、エビデンスアップロード、審査、QRコード生成・配信の処理。
  - `materials.json`: 商品情報（画像、テキスト）のメタデータ管理。
  - `uploads.json`: エージェントのアップロードエビデンス（スクリーンショット、URL、コメント）のメタデータ管理。
  - `data/`: 実際のファイル格納ディレクトリ  
    例: `sample_product.jpg`, `sample_description.txt`, `evidence_screenshot.png`, `qr_reward_<id>.png`

- **クライアント側 (例: `~/Projects2/client`)**
  - `index.html`: ユーザーインターフェース  
    → 商品リスト表示、ダウンロード、編集、エビデンスアップロード、QRコード受領機能を提供。
  - `script.js`: クライアント側のロジック  
    → サーバーAPI呼び出し、UI操作、画像・テキスト編集、カスタマイズ処理を実装。

### 2.2 動作環境
- **OS:** Ubuntu（最新安定版）
- **Python:** 3.x（Flaskおよび必要ライブラリ対応）
- **Webサーバー:**  
  - PythonのシンプルHTTPサーバー（例: `python -m http.server`）または軽量Webサーバー
- **ブラウザ:** 最新版のChrome、Firefox、Safari、Edgeなど

---

## 3. 機能要件

### 3.1 クライアント機能

#### 3.1.1 商品情報の参照・ダウンロード
- **入力:** 商品リストからの選択（IDまたは名称）
- **出力:** 選択商品（画像、テキストファイル）のダウンロード
- **仕様:**  
  - サーバーAPI `GET /materials` により商品リストをJSON形式で取得  
  - 個別商品は `GET /materials/<id>` によりダウンロード可能  
  - *拡張:* 商品カテゴリやタグによるフィルタリング機能

#### 3.1.2 商品情報のカスタマイズ
- **機能:**  
  - 画像編集：HTML5キャンバスを使用してテキスト追加、トリミング、サイズ変更、ロゴオーバーレイ
  - テキスト編集：テキストエリアでの説明文編集、タグ/ハッシュタグ追加
- **仕様:**  
  - 編集内容はリアルタイムプレビューを提供し、保存またはサーバー再アップロードが可能  
  - *ブレーンストーミング:* AIによる最適なハッシュタグ・画像レイアウトの提案

#### 3.1.3 SNS発信エビデンスのアップロード
- **入力:**  
  - スクリーンショット画像（PNG/JPEG、サイズチェック）
  - 発信URL（バリデーション済み）
  - コメント（自由記述）
- **出力:**  
  - `POST /uploads` によりエビデンスがアップロードされ、審査待ち状態で保存される
- **仕様:**  
  - ファイル形式・サイズのチェック、エビデンスと商品IDの紐付け  
  - *拡張:* SNS投稿の自動スクリーンショット取得ツールの検討

#### 3.1.4 QRコード付き特典の受領
- **動作:**  
  - サーバー側で審査が完了し、承認された場合に特典QRコードが生成・配信
- **入力:** サーバーからの通知（WebSocketまたはポーリング）
- **出力:**  
  - `GET /qr/<id>` によりQRコード画像（JPEG/PNG形式）のダウンロード
- **仕様:**  
  - QRコードはユニークなIDおよび特典情報（ポイント、クーポンコードなど）を含む  
  - *拡張:* QRコードにAR機能を付加する可能性

### 3.2 サーバー機能

#### 3.2.1 商品情報管理
- **機能:**  
  - 商品情報（画像、テキスト）の管理と提供
- **API仕様:**  
  - `GET /materials`: 商品リストをJSON形式で返す
  - `GET /materials/<id>`: 指定商品のファイルを返す
  - `POST /materials`: 新規商品の登録（管理者専用）

#### 3.2.2 アップロードエビデンス管理
- **機能:**  
  - エージェントからアップロードされたエビデンス（スクリーンショット、URL、コメント）の保存と管理
- **API仕様:**  
  - `POST /uploads`: エビデンスデータの保存（JSONで管理）  
  - 初期状態は「pending」、管理者の審査後に「approved」または「rejected」に更新

#### 3.2.3 審査処理
- **機能:**  
  - 管理者がWeb管理画面またはCLIを使用し、エビデンスを審査
- **仕様:**  
  - 審査基準：発信内容の適切性、画像品質、URLの有効性
  - ログ：審査担当者、日時、対象エビデンスの記録

#### 3.2.4 QRコード生成・配信
- **機能:**  
  - 審査通過エビデンスに対し、QRコード付き特典画像を生成・配信
- **API仕様:**  
  - `GET /qr/<id>`: 特定IDのQRコード画像を返す
- **仕様:**  
  - qrcodeライブラリを使用して生成し、ファイルシステム内（data/qr/）に保存
  - *拡張:* QRコードに暗号化やブロックチェーン連携の検討

### 3.3 エージェント運用ワークフロー
1. クライアントから商品情報を参照・ダウンロード
2. 商品情報をカスタマイズ（画像・テキスト編集）
3. SNS上でカスタマイズした内容を発信
4. 発信エビデンス（スクリーンショット、URL、コメント）をサーバーへアップロード
5. サーバー側でエビデンス審査（管理者の承認待ち）
6. 審査が承認された場合、QRコード付き特典画像を受領し、店舗で利用

---

## 4. 技術要件

### 4.1 サーバー側
- **言語/フレームワーク:** Python 3.x、Flask
- **依存ライブラリ:**  
  - `flask`, `flask-cors` (CORS対応)  
  - `qrcode`, `pillow` (QRコード生成および画像処理)  
  - `requests`（必要に応じたSNS API連携）  
  - `sqlite3` または `mysql-connector`（審査履歴・特典管理用データベースオプション）
- **ストレージ:**  
  - ファイルシステム (`data/` ディレクトリ)  
  - JSONファイル (`materials.json`, `uploads.json`)  
  - オプション：SQLite/MySQLによるログ・ステータス管理
- **API設計:**  
  - RESTful API（GET/POSTメソッド対応）  
  - エラーハンドリング（404、500、401などのHTTPステータス）
  - WebSocketまたはポーリングによるリアルタイム通知（QRコード配信用）

### 4.2 クライアント側
- **言語/フレームワーク:** HTML5、JavaScript (ES6+)、CSS
- **UI要件:**  
  - レスポンシブデザイン（モバイル・デスクトップ対応）
  - HTML5キャンバスによる画像編集
  - テキストエリアによるテキスト編集
  - モーダルダイアログ（アップロード確認、エラー表示）
- **API通信:**  
  - fetch APIを用いたサーバー通信  
  - ローカルストレージまたはIndexedDBによる一時保存
- **拡張機能:**  
  - ブラウザAPIやHTML5 Canvasを利用したスクリーンショット取得  
  - オプション：SNS認証連携（Twitter、Instagramなど）

### 4.3 セキュリティ
- **認証:**  
  - JWT（JSON Web Token）またはOAuth2によるエージェント別アクセス制御
- **データ保護:**  
  - アップロードファイルの形式、サイズ、ウイルスチェック
  - HTTPS（SSL/TLS）の有効化
  - エビデンスデータの保存時暗号化
- **アクセス制御:**  
  - 適切なCORS設定（許可ドメインの限定）
  - 管理者権限の明確な分離

---

## 5. 動作確認手順

### 5.1 サーバー起動
1. `~/Projects2/server` ディレクトリに移動
2. 必要ライブラリをインストール  
   ```bash
   pip install flask flask-cors qrcode pillow requests sqlite3
   ```
3. `python server.py` を実行（例: ポート8080で起動）

### 5.2 クライアント起動
1. `~/Projects2/client` ディレクトリに移動
2. 以下のコマンドでWebサーバーを起動  
   ```bash
   python -m http.server 8000
   ```
3. ブラウザで [http://localhost:8000/index.html](http://localhost:8000/index.html) にアクセス

### 5.3 テスト項目
- **商品リスト表示:**  
  - サーバーAPI `GET /materials` により商品リストが正しく表示されるか
- **ダウンロード・編集:**  
  - 個別商品のダウンロードおよびHTML5キャンバスによる編集機能の動作確認
- **SNS発信エビデンスアップロード:**  
  - スクリーンショット、URL、コメントのアップロードが正しくサーバーへ送信され、JSONファイルに記録されるか
- **審査処理:**  
  - 管理者操作によりエビデンスのステータス更新（`pending` → `approved`/`rejected`）が反映されるか
- **QRコード受領:**  
  - 承認後、`GET /qr/<id>` によるQRコード画像のダウンロードが可能か
- **エラーケース:**  
  - 無効なファイル形式、認証エラー、ネットワーク障害時の動作確認

---

## 6. 制限事項
- **スケーラビリティ:**  
  - ファイルシステムベースのストレージは大量データには不向き。データベースやクラウドストレージへの移行が必要
- **審査の自動化:**  
  - 現在は手動審査に依存。AIや機械学習による自動審査は追加開発が必要
- **セキュリティ:**  
  - 基本認証だけでは不十分な場合があるため、OAuth2や多要素認証の導入を検討

---

## 7. 拡張アイデア（ブレーンストーミング）
- **機能拡張:**  
  - AIによる画像認識でエビデンスの有効性自動判定
  - WebSocketによるリアルタイム審査結果・QRコード通知
  - エージェント活動データの解析と報酬最適化
  - 多言語対応（日本語、英語、中国語）
- **技術的挑戦:**  
  - ブロックチェーン連携によるQRコード利用履歴の管理
  - モバイルアプリ連携（WeChat API活用）
  - クラウドストレージ（AWS S3、Google Cloud Storage）を用いた大規模データ管理
- **ビジネスモデル:**  
  - エージェント向けのサブスクリプション（月額課金）
  - 商品宣伝内の広告収益化
  - 他店舗やブランドとのパートナーシップによる共通プラットフォーム展開

---

## 8. 参考資料
- **WeChatミニプログラム公式ドキュメント:**  
  [https://developers.weixin.qq.com/miniprogram/en/dev/](https://developers.weixin.qq.com/miniprogram/en/dev/)
- **Flaskドキュメント:**  
  [https://flask.palletsprojects.com/](https://flask.palletsprojects.com/)
- **QRコード生成ライブラリ (qrcode):**  
  [https://pypi.org/project/qrcode/](https://pypi.org/project/qrcode/)
- **画像処理ライブラリ (Pillow):**  
  [https://pillow.readthedocs.io/](https://pillow.readthedocs.io/)
- **セキュリティ実装ガイド (OWASP Top Ten):**  
  [https://owasp.org/www-project-top-ten/](https://owasp.org/www-project-top-ten/)

---

## 9. 補足説明
このシステムは、お店がたくさんの人に商品を知ってもらうための「お手伝いツール」です。  
- **お店の人**は商品情報（写真や説明）を準備します。  
- **お手伝いさん（エージェント）**はその情報をもとに、SNSで商品を紹介して、紹介した証拠（スクリーンショット）をサーバーに送ります。  
- お店の人が証拠をチェックして「大丈夫！」と認めると、お手伝いさんは特別なQRコードが付いた画像をもらい、そのQRコードを使ってお店でお得な特典を受け取れます。  

---
